<%- contentFor('meta') %>
<title>My Profile</title>
<%- contentFor('styles') %>
<%- contentFor('scripts') %>
<script>
  $(document).ready(function() {
    $('#profile-form').on('submit', function(e) {
      e.preventDefault()

      axios({
        method: 'PUT',
        url: '/api/my/profile',
        data: new FormData(e.target)
      }).then(function(resp) {
        window.location.reload()
      }).catch(function(err) {
        switch (err.response.status) {
          case 406: {
            const { response: { data: { errors } }} = err

            $('#profile-form').find('.invalid-feedback').empty()
            $('#profile-form').find('.is-invalid').removeClass('is-invalid')

            errors.forEach(function(error) {
              const { param: fieldName, msg } = error
              const $input = $('#profile-form').find(`[name="${fieldName}"]`)
              const $invalidFeedback = $input.siblings('.invalid-feedback')
              $input.addClass('is-invalid')
              $invalidFeedback.text(msg)
            })
            break
          }
          default: {
            alert(err.response.data.message)
          }
        }
      })
    })
  })
</script>
<%- contentFor('body') %>
<div id="my-profile-show" class="container my-3">
  <h1 class="text-center mb-3">My Profile</h1>

  <div class="row">
    <div class="col-12 col-sm-8 offset-sm-2">
      <form id="profile-form" novalidate>
        <div class="form-group">
          <label>First Name</label>
          <input class="form-control" type="text" name="firstName" value="<%= currentUser.firstName %>">
          <div class="invalid-feedback"></div>
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input class="form-control" type="text" name="lastName" value="<%= currentUser.lastName %>">
          <div class="invalid-feedback"></div>
        </div>

        <% if (currentUser.avatar) { %>
          <img src="<%= currentUser.avatar %>" alt="avatar" style="width: 100px; height: auto;">
        <% } %>

        <div class="input-group mb-3">
          <div class="custom-file">
            <input id="avatar-file-input" type="file" class="custom-file-input" name="avatar">
            <label class="custom-file-label" for="avatar-file-input">Avatar</label>
            <div class="invalid-feedback"></div>
          </div>
        </div>

        <button class="btn btn-success">Submit</button>
      </form>
    </div>
  </div>
</div>
